#+TITLE: Razor File Manager - Project Status
#+AUTHOR: justyntemme
#+DATE: 2024

* Completed Features
** DONE Background Right-Click Menu
   CLOSED: [2024-11-29]
   - [X] Right-click on empty space in file list shows context menu
   - [X] Background menu shows: New File, New Folder, Paste (if clipboard has content)
   - [X] Works in empty directories
   - [X] File-specific options (Copy, Cut, Delete, etc.) only shown for file/folder clicks

** DONE Path Navigation Bug Fix
   CLOSED: [2024-11-29]
   - [X] Handle ~ for home directory
   - [X] Handle ~/path tilde expansion
   - [X] Handle absolute Unix paths (/usr/bin)
   - [X] Handle relative paths (../, ./)
   - [X] Handle Windows drive letters (C:\, D:\)
   - [X] Handle UNC paths (\\server\share)
   - [X] Validate paths before navigation

** DONE Create New File/Folder Dialog
   CLOSED: [2024-11-29]
   - [X] Add "New File" to right-click context menu
   - [X] Add "New Folder" to right-click context menu
   - [X] Keyboard shortcuts (Ctrl+N file, Ctrl+Shift+N folder)
   - [X] Modal dialog with text input
   - [X] Validation (prevent duplicates)
   - [X] Refresh directory after creation

** DONE Open With Support
   CLOSED: [2024-11-29]
   - [X] Linux: xdg-open, kde-open5, gio support
   - [X] macOS: open command, Finder reveal
   - [X] Windows: ShellExecuteW, rundll32 OpenAs_RunDLL
   - [X] Add "Open With..." to context menu (files only)

** DONE Search Improvements
   CLOSED: [2024-11-29]
   - [X] Search-as-you-type for simple filename searches
   - [X] Directives (contents:, ext:, size:, modified:, filename:) require Enter
   - [X] Clear button (X) appears when search active or showing results
   - [X] Clicking X clears search and restores directory
   - [X] "Search Results" badge shows when viewing search results
   - [X] Progress indicator for directive searches (not just contents:)
   - [X] Proper state tracking (IsSearchResult, SearchQuery in State)
   - [X] Fix bug where empty search didn't restore contents
   - [X] Fix race condition: generation counter prevents stale results
   - [X] Stale search results no longer overwrite directory after clear
   - [X] Visual directive pills: recognized directives shown as colored tags
   - [X] Color-coded pills: contents=orange, ext=green, size=blue, modified=pink
   - [X] Placeholder changes to "press Enter to search" when directives detected
   - [X] Fix: typing directive prefix (e.g., "contents:") no longer triggers search
   - [X] Fix: incomplete directives (no value after colon) are rejected
   - [X] Added hasCompleteDirective() and isIncompleteDirective() validation
   - [X] ARCHITECTURE FIX: Separate dirEntries (canonical) from rawEntries (display)
   - [X] Search results only overwrite rawEntries, never dirEntries
   - [X] Directive detection restores directory from cache immediately
   - [X] directiveRestored flag prevents redundant restore calls
   - [X] Gen counter incremented on restore to invalidate pending results
   - [X] FIX: Default search depth now 1 (current dir only)
   - [X] Added recursive: directive for deep search (recursive:N for depth N)
   - [X] Added depth: alias for recursive:
   - [X] Progress bar now updates during content search via ProgressChan
   - [X] Yellow pill color for recursive/depth directives
   - [X] SEARCH CANCELLATION: Clicking X now cancels ongoing searches
   - [X] Context-based cancellation using context.Context
   - [X] Skip system directories (/dev, /proc, /sys, /run, etc.)
   - [X] Skip non-regular files (devices, sockets, etc.)
   - [X] Graceful handling of permission errors (skip instead of fail)
   - [X] FIX: Search runs in goroutine to allow cancel processing
   - [X] FIX: FetchDir cancels any running search
   - [X] Context-aware content reading with chunked I/O
   - [X] Binary file detection (skip files with null bytes)

** DONE Search Engine Integration
   CLOSED: [2024-11-29]
   - [X] Detect available search engines (ripgrep, ugrep)
   - [X] Settings dropdown shows installed engines with versions
   - [X] Unavailable engines shown greyed out (not selectable)
   - [X] Engine selection persisted in Renderer state
   - [X] External engine support for contents: directive
   - [X] ripgrep integration with --files-with-matches
   - [X] ugrep integration with -l flag and -r for recursion
   - [X] External results combined with other directive filters
   - [X] Fallback to builtin on external engine error
   - [X] FIX: ugrep now uses -r flag for recursive search
   - [X] FIX: Depth mapping corrected (our depth=1 = tool depth=0)
   - [X] Streaming progress during external search ("Found X files...")
   - [X] Debug logging for external search commands
   - [X] Indeterminate progress bar (animated sliding bar) for external search
   - [X] Search engine setting saved to database (persists across restarts)

** DONE Rename File/Folder
   CLOSED: [2024-11-29]
   - [X] Add "Rename" to context menu
   - [X] Inline editing in file list
   - [X] Keyboard shortcut (F2)
   - [X] Validation (prevent duplicates, invalid chars)

** DONE Theme Settings
   CLOSED: [2024-11-29]
   - [X] Light/Dark theme toggle in settings
   - [X] Theme preference saved to database
   - [X] Theme applied on startup

* In Progress
** TODO Drag and Drop (On Hold)
   - [ ] Drag files to move
   - [ ] Drag to folders to move into
   - [ ] Ctrl+drag to copy
   - [ ] Visual feedback during drag
   Note: Put on hold due to implementation challenges with Gio

* Planned Features
** TODO File Preview Panel
   - [ ] Image thumbnails
   - [ ] Text file preview
   - [ ] File metadata display
   - [ ] Toggle preview panel

** TODO Tabs/Multi-window
   - [ ] Tab bar for multiple directories
   - [ ] Ctrl+T new tab
   - [ ] Ctrl+W close tab
   - [ ] Drag tabs to reorder
   - [ ] Click tab to switch between open navigation tabs
   - [ ] Split window view (stretch goal)
   - [ ] Vertical/horizontal split options

** TODO Bookmarks Enhancement
   - [ ] Bookmark folders (not just favorites)
   - [ ] Bookmark groups/categories
   - [ ] Quick access sidebar customization

** TODO File Operations
   - [ ] Undo/Redo for file operations
   - [ ] Batch rename
   - [ ] File compression (zip/tar)
   - [ ] File extraction

** DONE Copy/Paste Replace Dialog
   CLOSED: [2024-11-29]
   - [X] Detect file name collisions on paste
   - [X] Mac-style dialog: "Keep Both", "Stop", "Replace"
   - [X] "Apply to All" checkbox for batch operations
   - [X] Skip option
   - [X] Compare dates/sizes in dialog
   - [ ] "Replace if Newer" setting option (FileZilla-style)
   - [ ] Multi-file paste with batch conflict handling

** TODO Network/Remote Access
   - [ ] FTP connection support
   - [ ] SFTP connection support
   - [ ] SMB/CIFS network shares (Windows shares)
   - [ ] NFS mount support
   - [ ] WebDAV support
   - [ ] Save connection profiles
   - [ ] Quick connect dialog
   - [ ] Connection manager sidebar

** TODO View Modes
   - [ ] Grid/icon view
   - [ ] List view (current)
   - [ ] Column view (macOS style)
   - [ ] Thumbnail size options

** TODO Advanced Search
   - [ ] Save search queries
   - [ ] Search history
   - [ ] Regex support
   - [ ] Search in file contents (already partial)

** TODO Keyboard Navigation
   - [ ] Type-to-select (type filename to jump)
   - [ ] Vim-style navigation option
   - [ ] Customizable shortcuts

** TODO Settings/Preferences
   - [X] Theme selection (light/dark)
   - [ ] Font size options
   - [ ] Default view mode
   - [ ] Startup directory
   - [X] Confirm before delete toggle

* Known Bugs
** TODO Fix dark mode
   - Theme colors not fully applied to all UI elements
   - Need to update hardcoded colors to use theme palette

** TODO Context menu positioning
   - Menu can appear off-screen near edges

** TODO Large directory performance
   - Directories with 10k+ files can be slow
   - Consider virtualized list

* Technical Debt
** TODO Code Organization
   - [ ] Split large files into smaller modules
   - [ ] Add comprehensive tests
   - [ ] Document public APIs

** TODO Error Handling
   - [ ] User-friendly error messages
   - [ ] Error notification system
   - [ ] Logging improvements

* Notes
- Using Gio UI framework (gioui.org)
- SQLite for favorites/settings persistence
- Cross-platform: Linux, macOS, Windows
- Build with: go build ./cmd/razor
- Debug build: go build -tags debug ./cmd/razor
